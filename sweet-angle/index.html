<!DOCTYPE html><html class="no-js"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Sweet Angle - AngularJS directives with ease</title><meta name="description" content=""><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="css/responsive.css"><link rel="stylesheet" type="text/css" href="//highlightjs.org/static/styles/obsidian.css"><link href="http://fonts.googleapis.com/css?family=Lato:300" rel="stylesheet" type="text/css"><link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700" rel="stylesheet" type="text/css"><link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css"></head><body><div class="content"><img src="img/logo.png" alt="" class="logo"><h1 id="write-your-angular-directives-with-ease">write your angular directives with ease</h1>
<p>Sweet Angle is an opinionated source to source translator that
allows you to write AngularJS directives with a very concise syntax and convert them
to vanilla JS. I use it for myself and find it very useful so I am sharing it on the net.</p>
<p>It is based on macro expansion and covers the majority of the cases in which you may 
need a directive. </p>
<h2 id="installation">Installation</h2>
<pre><code>$ npm install sweet-angle
</code></pre><h2 id="usage">Usage</h2>
<pre><code>$ sweet-angle directive.sa -a application &gt; directive.js
</code></pre><p>where <code>-a</code> is used to pass the name of the application for which
you want to generate the directive.</p>
<h2 id="the-syntax">The syntax</h2>
<p>Let&#39;s assume we want to write a directive for a progress bar: </p>
<pre><code>&lt;div id=&#39;pb&#39; progress-bar value=&#39;statusToBeShown&#39; color=&#39;blue&#39; max=&#39;100&#39;&gt;&lt;/div&gt;
</code></pre><p>The directive 
has two attributes passed by value (<code>color, max</code>) and one passed by reference (<code>value</code>):</p>
<ul>
<li><code>value</code> represents the current percentage to be shown on the progress bar.</li>
<li><code>color</code> represents the name of the class to be used for coloring the bar.</li>
<li><code>max</code> represents the maximum value that <code>value</code> can assume.</li>
</ul>
<p>Let&#39;s write the beginning of the directive in Sweet Angle:</p>
<pre><code>directive progressBar {
 import                 /* none */;
 byref    value;        /* two-way angularjs bind */
 byval    color, max;   /* one-way angularjs bind */
 callback               /* none */; 
 ...
</code></pre><p>Here, the <code>import</code> clause does not import anything but it could be
used to import other angular modules (e.g., <code>import $q, $restangular;</code>).</p>
<p>The <code>byref</code> clause is used to create a local scope variable that mirrors 
another one in the parent scopes (uses Angular&#39;s scope qualifier 
&#39;<code>=</code>&#39; internally).</p>
<p>The <code>byval</code> clause is used to create a one way bind, from parent scope(s)
to the local one (uses Angular&#39;s scope qualifier 
&#39;<code>@</code>&#39; internally). </p>
<p><code>callback</code> can be used to pass one or many callbacks to the directive (uses Angular&#39;s scope qualifier 
&#39;<code>&amp;</code>&#39; internally)</p>
<p>Next we specify the template by using Jade&#39;s syntax: </p>
<pre><code> template `
div 
 .ui.progress.transition.active(ng-class=&#39;[visibility, color]&#39;)
   .bar(style=&#39;{{bsize}}&#39;)
`;
</code></pre><p>Note two additional scope variables used here: <code>visibility</code> and <code>bsize</code>.</p>
<p>Now we need to define is the <code>create</code> method. 
This is converted by Sweet Angle into the directive&#39;s <code>link</code> function 
with some desugaring:</p>
<ul>
<li><code>create</code> is invoked having <code>this</code> mapped to <code>$scope</code>.</li>
<li><code>@</code> can be used as an alias <code>this</code>.</li>
</ul>
<p>First, let&#39;s save the parameter <code>elem</code> into the local scope, for convenience:</p>
<pre><code> create(elem, attr) {
   @elem = elem;
   ...
</code></pre><p>Let&#39;s start by making the progress bar invisible:</p>
<pre><code>   ...
   @visibility = &#39;hidden&#39;;
   ...
</code></pre><p>and define a function that enables us to toggle the 
visibility of the bar:</p>
<pre><code>   ...
   @toggle = function() { 
     if(@visibility === &#39;hidden&#39;) {
      @visibility = &#39;&#39;;
     } else {
      @visibility = &#39;hidden&#39;;
     }
   }.bind(this)
   ...
</code></pre><p>Now, we need to take care of the changes to <code>$scope.value</code> (or <code>@value</code>) to visually
update the bar. First
we define an event listener that updates <code>$scope.bsize</code> with the new bar size:</p>
<pre><code>   @onValueChange = function() { 
     var perc;
     perc = @value/parseFloat(@max)*window.jQuery(@elem).width();
     @bsize = &quot;width: &quot;+perc+&quot;px;&quot;
   }.bind(this)
</code></pre><p>and, second, we register the event listener on any change to <code>value</code>.</p>
<pre><code>   ...
   @$watch(&#39;value&#39;, @onValueChange);

    } /* ends create */
}; /* ends the directive */
   ...
</code></pre><h2 id="result">Result</h2>
<p>The complete directive is here:</p>
<pre><code>directive progressBar for application {
 import   /* none */;
 byref    value;
 byval    color, max;
 callback /* none */; 

 template `
div 
 .ui.progress.transition.active(ng-class=&#39;[visibility, color]&#39;)
   .bar(style=&#39;{{bsize}}&#39;)
`;

 create(elem, attr) {
   @visibility = &#39;hidden&#39;;
   @elem = elem;

   @toggle = function() { 
     if(@visibility === &#39;hidden&#39;) {
      @visibility = &#39;&#39;;
     } else {
      @visibility = &#39;hidden&#39;;
     }
     @onValueChange();
   }

   @onValueChange = function() { 
     var perc;
     perc = @value/parseFloat(@max)*window.jQuery(@elem).width();
     @bsize = &quot;width: &quot;+perc+&quot;px;&quot;
   }

   @$watch(&#39;value&#39;, @onValueChange);

 } /* ends create */

};
</code></pre><p>And the conversion to vanilla JS is here:</p>
<pre><code>angular.module(&#39;application&#39;).directive(&#39;progressBar&#39;, function () {
    console.log(arguments);
    var ret = {};
    ret.restrict = &#39;A&#39;;
    ret.template = &#39;&lt;div&gt;&lt;div ng-class=&quot;[visibility, color]&quot; class=&quot;ui progress transition active&quot;&gt;&lt;div style=&quot;{{bsize}}&quot; class=&quot;bar&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#39;;
    ret.replace = true;
    ret.scope = {};
    ret.scope.value = &#39;=&#39;;
    ret.scope.color = &#39;@&#39;;
    ret.scope.max = &#39;@&#39;;
    ret.link = function (s) {
        (function (elem, attr) {
            this.visibility = &#39;hidden&#39;;
            this.elem = elem;
            this.toggle = function () {
                if (this.visibility === &#39;hidden&#39;) {
                    this.visibility = &#39;&#39;;
                } else {
                    this.visibility = &#39;hidden&#39;;
                }
                this.onValueChange();
            };
            this.onValueChange = function () {
                var perc;
                perc = this.value / parseFloat(this.max) * window.jQuery(this.elem).width();
                this.bsize = &#39;width: &#39; + perc + &#39;px;&#39;;
            };
            this.$watch(&#39;value&#39;, this.onValueChange);
        }.apply(s, Array.prototype.slice.call(arguments, 1)));
    };
    return ret;
});
</code></pre><h2 id="accessing-the-directive-scope">Accessing the directive scope</h2>
<p>To get to the isolated scope of the directives created, you can use the following 
helper:</p>
<pre><code>window.$$ = function(sel) {
                return angular.element(document.querySelector(sel)).isolateScope();
}
</code></pre><p>So, for example, you can toggle the progress bar visibility by using:</p>
<pre><code>    $$(&#39;#pb&#39;).toggle()
</code></pre><h2 id="-fork-it-on-git-hub-https-github-com-vzaccaria-sweet-angle-"><a href="https://github.com/vzaccaria/sweet-angle">Fork it on Git-hub</a></h2>
</div><div class="end"><div class="overlay">       <p>Written by <a href="http://www.vittoriozaccaria.net">Vittorio Zaccaria</a></p>
<p>Inspired by <a href="https://gist.github.com/aaronpowell">Aaron Powell Sweetjs Macros</a></p>
<p>Footnote background image by <a href="http://www.flickr.com/davideragusa">Davide Ragusa</a></p>
</div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script>window.jQuery || document.write('<script src="js/vendor/<jquery-1 class="11 0"></jquery-1>.min.js"><\/script>')</script><script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script>_uacct = "UA-4069654-2"; 
urchinTracker(); 
</script></body></html>